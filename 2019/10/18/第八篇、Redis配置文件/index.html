<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000">
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top">
  
  
  <title>Redis配置文件 | yaoyao的小屋</title>
  <meta name="description" content="Redis配置文件整理">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis配置文件">
<meta property="og:url" content="http://1445103710.github.io/2019/10/18/第八篇、Redis配置文件/index.html">
<meta property="og:site_name" content="yaoyao的小屋">
<meta property="og:description" content="Redis配置文件整理">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-10-18T03:40:05.098Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Redis配置文件">
<meta name="twitter:description" content="Redis配置文件整理">
  <!-- Canonical links -->
  <link rel="canonical" href="http://1445103710.github.io/2019/10/18/第八篇、Redis配置文件/index.html">
  
    <link rel="alternate" href="/atom.xml" title="yaoyao的小屋" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  <link rel="stylesheet" href="/css/style.css">
  
  
  
  
</head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/1445103710" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">yaoyao</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">天行健，君子自强不息</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> hefei, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form" method="GET" action="https://www.baidu.com/s?">
	<div class="input-group">
    	<input name="wd" type="text" class="form-control search-form-input" placeholder="搜索" />
	    <span class="input-group-btn">
	    	<button type="submit" class=" btn btn-flat search-form-submit"><i class="icon icon-search"></i></button>
	    </span>
    </div>
</form>

</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav ">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">首页</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">归档</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">分类</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">标签</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">项目</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-books">
          <a href="/books">
            
            <i class="icon icon-book-fill"></i>
            
            <span class="menu-title">书单</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">友链</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">关于</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/1445103710" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">公告</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>欢迎交流与分享经验!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">分类</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/java分类/">java分类</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux基础分类/">linux基础分类</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库分类/">数据库分类</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/网络基础分类/">网络基础分类</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      

    
      
    
      
  <div class="widget">
    <h3 class="widget-title">归档</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/linux基础分类/">linux基础分类</a>
              </p>
              <p class="item-title">
                <a href="/2019/10/18/第八篇、Redis配置文件/" class="title">Redis配置文件</a>
              </p>
              <p class="item-date">
                <time datetime="2019-10-18T02:48:32.000Z" itemprop="datePublished">2019-10-18</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/java分类/">java分类</a>
              </p>
              <p class="item-title">
                <a href="/2019/10/17/第七篇、spring、springMvc、springBoot和springCloud的联系与区别/" class="title">第七篇、spring、springMvc、springBoot和springCloud的联系与区别</a>
              </p>
              <p class="item-date">
                <time datetime="2019-10-17T10:01:07.000Z" itemprop="datePublished">2019-10-17</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/java分类/">java分类</a>
              </p>
              <p class="item-title">
                <a href="/2019/10/16/第六篇、springboot指定端口的三种方式/" class="title">第六篇、springboot指定端口的三种方式</a>
              </p>
              <p class="item-date">
                <time datetime="2019-10-16T07:58:43.000Z" itemprop="datePublished">2019-10-16</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/java分类/">java分类</a>
              </p>
              <p class="item-title">
                <a href="/2019/10/15/第五篇、springboot项目实现jar包外配置文件管理/" class="title">第五篇、springboot项目实现jar包外配置文件管理</a>
              </p>
              <p class="item-date">
                <time datetime="2019-10-15T06:24:05.000Z" itemprop="datePublished">2019-10-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/数据库分类/">数据库分类</a>
              </p>
              <p class="item-title">
                <a href="/2019/10/12/第四篇、简易安装oracle客户端/" class="title">第四篇、简易安装oracle客户端</a>
              </p>
              <p class="item-date">
                <time datetime="2019-10-12T02:54:35.000Z" itemprop="datePublished">2019-10-12</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<main class="main" role="main">
  <div class="content">
  <article id="post-第八篇、Redis配置文件" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      Redis配置文件
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2019/10/18/第八篇、Redis配置文件/" class="article-date">
	  <time datetime="2019-10-18T02:48:32.000Z" itemprop="datePublished">2019-10-18</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/linux基础分类/">linux基础分类</a>
  </span>

        

        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2019/10/18/第八篇、Redis配置文件/#comments" class="article-comment-link">评论</a></span>
        
      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <p>Redis配置文件整理</p>
<a id="more"></a>
<hr>
<h4 id="INCLUDES"><a href="#INCLUDES" class="headerlink" title="INCLUDES"></a>INCLUDES</h4><p>可引用外部的配置文件。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># include /path/to/local.conf</span></span><br><span class="line"><span class="comment"># include /path/to/other.conf</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="MODULES"><a href="#MODULES" class="headerlink" title="MODULES"></a>MODULES</h4><p>模块化，可以让用户自己编写代码来实现和扩展redis不具备的功能。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># loadmodule /path/to/my_module.so</span></span><br><span class="line"><span class="comment"># loadmodule /path/to/other_module.so</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="NETWORK"><a href="#NETWORK" class="headerlink" title="NETWORK"></a>NETWORK</h4><p>绑定主机地址。默认不设置的话，redis会响应本机所有可用网卡的连接请求。也可以通过bind配置项来指定要绑定的IP。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#bind 127.0.0.1</span></span><br></pre></td></tr></table></figure>

<p>保护模式。为了禁止公网访问redis cache,用于加强redis安全的，如果这个值设置了yes，从外网访问则会返回相应的DENIED Redis is running in protected mode错误，如果有需求想要外网访问redis，这个值设置成no，并将上面的bind 127.0.0.1注释掉。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">protected-mode</span> <span class="string">no</span></span><br></pre></td></tr></table></figure>

<p>监听端口号。如果设为0，redis将不在socket 上监听任何客户端连接。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">port</span> <span class="string">6379</span></span><br></pre></td></tr></table></figure>

<p>TCP监听的最大容纳数量。<br>在高并发的环境下，你需要把这个值调高以避免客户端连接缓慢的问题。在高并发环境下，需要一个高backlog值来避免慢客户端连接问题。注意Linux内核会将这个值减小到/proc/sys/net/core/somaxconn的值，所以需要确认增大somaxconn和tcp_max_syn_backlog两个值来打到想要的效果。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">tcp-backlog</span> <span class="string">511</span></span><br></pre></td></tr></table></figure>

<p>指定 unix socket 的路径。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># unixsocket /tmp/redis.sock</span></span><br><span class="line"><span class="comment"># unixsocketperm 700</span></span><br></pre></td></tr></table></figure>

<p>间隔N秒后无响应关闭连接。（0忽略）</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">timeout</span> <span class="string">0</span></span><br></pre></td></tr></table></figure>

<p>tcp心跳检测。单位为秒，如果设置为0，则不会进行keeyalive检测，建议设置成60。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">tcp-keepalive</span> <span class="string">60</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="GENERAL"><a href="#GENERAL" class="headerlink" title="GENERAL"></a>GENERAL</h4><p>是否设置守护线程。<br>redis采用单进程多线程的模式。设置为yes，代表守护进程模式，redis会在后台运行，并将pid号写入redis.conf选项pidfile设置的文件中，此redis将一直运行，kill进程结束。<br>设置为no，进入redis命令界面，exit强制退出或者关闭连接工具(putty,xshell等)都会导致redis进程退出。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">daemonize</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<p>可以通过upstart和systemd管理Redis守护进程。<br>选项：<br>supervised no - 没有监督互动<br>supervised upstart - 通过将Redis置于SIGSTOP模式来启动信号<br>supervised systemd - signal systemd将READY = 1写入$ NOTIFY_SOCKET<br>supervised auto - 检测upstart或systemd方法基于 UPSTART_JOB或NOTIFY_SOCKET环境变量。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">supervised</span> <span class="string">no</span></span><br></pre></td></tr></table></figure>

<p>进程管道ID文件。<br>当redis作为守护进程运行的时候，它会把 pid 默认写到 /var/run/redis.pid 文件里面， 也可以在这里自己制定它的文件位置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pidfile</span> <span class="string">/var/run/redis_6379.pid</span></span><br></pre></td></tr></table></figure>

<p>设置日志级别。<br>debug（记录大量日志信息，适用于开发、测试阶段）<br>verbose（较多日志信息）<br>notice（适量日志信息，使用于生产环境）<br>warning（仅有部分重要、关键信息才会被记录）</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">loglevel</span> <span class="string">notice</span></span><br></pre></td></tr></table></figure>

<p>日志记录方式，默认为标准输出，如果配置为redis为守护进程方式运行，而这里又配置为标准输出，则日志将会发送给/dev/null。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logfile</span> <span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>是否启用log。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">syslog-enabled</span> <span class="string">no</span></span><br></pre></td></tr></table></figure>

<p>日志内容身份或识别ID，以redis开头。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">syslog-ident</span> <span class="string">redis</span></span><br></pre></td></tr></table></figure>

<p>指定系统日志设置，必须是 USER 或者是 LOCAL0-LOCAL7 之间的值。指定syslog设备，值可以是user或local0-local7。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">syslog-facility</span> <span class="string">local0</span></span><br></pre></td></tr></table></figure>

<p>redis库数量，默认16。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">databases</span> <span class="string">16</span></span><br></pre></td></tr></table></figure>

<p>启动时是否显示Logo。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">always-show-logo</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="SNAPSHOTTING"><a href="#SNAPSHOTTING" class="headerlink" title="SNAPSHOTTING"></a>SNAPSHOTTING</h4><p>指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合。<br>满足以下条件将会同步数据:</p>
<p>900秒（15分钟）内有1个更改。</p>
<p>300秒（5分钟）内有10个更改。</p>
<p>60秒内有10000个更改。</p>
<p>Note: 可以把所有“save”行注释掉，这样就取消同步操作了。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">save</span> <span class="string">900 1</span></span><br><span class="line"><span class="meta">save</span> <span class="string">300 10</span></span><br><span class="line"><span class="meta">save</span> <span class="string">60 10000</span></span><br></pre></td></tr></table></figure>

<p>RDB快照不能用时，redis将停止写入。设置为no,表示不在乎数据不一致或者有其他手段发现和控制。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">stop-writes-on-bgsave-error</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<p>指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">rdbcompression</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<p>在存储快照后，我们还可以让redis使用CRC64算法来进行数据校验，但是这样做会增加大约10%的性能消耗，如果希望获取到最大的性能提升，可以关闭此功能。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">rdbchecksum</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<p>设置存储快照文件名</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dbfilename</span> <span class="string">dump6379.rdb</span></span><br></pre></td></tr></table></figure>

<p>指定数据库文件(快照文件)存放目录。一定是个目录，不能是文件名。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dir</span> <span class="string">/usr/local/redis/data</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="REPLICATION"><a href="#REPLICATION" class="headerlink" title="REPLICATION"></a>REPLICATION</h4><p>主从复制，使用 slaveof 来让一个 redis 实例成为另一个reids 实例的副本，默认关闭注意这个只需要在 slave 上配置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># slaveof &lt;masterip&gt; &lt;masterport&gt;</span></span><br></pre></td></tr></table></figure>

<p>主从复制，如果 master 需要密码认证，就在这里设置，默认不设置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">masterauth</span> <span class="string">&lt;master-password&gt;</span></span><br></pre></td></tr></table></figure>

<p>当一个 slave 与 master 失去联系，或者复制正在进行的时候，slave 可能会有两种表现：<br>①如果为 yes ，slave 仍然会应答客户端请求，但返回的数据可能是过时，或者数据可能是空的在第一次同步的时候 。<br>②如果为 no ，在你执行除了 info he salveof 之外的其他命令时，slave 都将返回一个 “SYNC with master in progress” 的错误。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">slave-serve-stale-data</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<p>配置一个 slave 实体是否接受写入操作。<br>通过写入操作来存储一些短暂的数据对于一个 slave 实例来说可能是有用的，因为相对从 master 重新同步数而言，据数据写入到 slave会更容易被删除。但是如果客户端因为一个错误的配置写入，也可能会导致一些问题。从 redis 2.6 版起，默认 slaves 都是只读的。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">slave-read-only</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<p>主从数据复制是否使用无硬盘复制功能。<br>新的从站和重连后不能继续备份的从站，需要做所谓的“完全备份”，即将一个RDB文件从主站传送到从站。<br>这个传送有以下两种方式：<br>①硬盘备份：redis主站创建一个新的进程，用于把RDB文件写到硬盘上。过一会儿，其父进程递增地将文件传送给从站。<br>②无硬盘备份：redis主站创建一个新的进程，子进程直接把RDB文件写到从站的套接字，不需要用到硬盘。<br>在硬盘备份的情况下，主站的子进程生成RDB文件。一旦生成，多个从站可以立即排成队列使用主站的RDB文件。<br>在无硬盘备份的情况下，一次RDB传送开始，新的从站到达后，需要等待现在的传送结束，才能开启新的传送。如果使用无硬盘备份，主站会在开始传送之间等待一段时间（可配置，以秒为单位），希望等待多个子站到达后并行传送。<br>在硬盘低速而网络高速（高带宽）情况下，无硬盘备份更好。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">repl-diskless-sync</span> <span class="string">no</span></span><br></pre></td></tr></table></figure>

<p>当启用无硬盘备份，服务器等待一段时间后才会通过套接字向从站传送RDB文件，这个等待时间是可配置的。<br>这一点很重要，因为一旦传送开始，就不可能再为一个新到达的从站服务。从站则要排队等待下一次RDB传送。因此服务器等待一段时间以期更多的从站到达。<br>延迟时间以秒为单位，默认为5秒。要关掉这一功能，只需将它设置为0秒，传送会立即启动。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">repl-diskless-sync-delay</span> <span class="string">5</span></span><br></pre></td></tr></table></figure>

<p>从redis会周期性的向主redis发出PING包，你可以通过repl_ping_slave_period指令来控制其周期，默认是10秒。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># repl-ping-slave-period 10</span></span><br></pre></td></tr></table></figure>

<p>接下来的选项为以下内容设置备份的超时时间：<br>①从从站的角度，同步期间的批量传输的I/O<br>②从站角度认为的主站超时（数据，ping）<br>③主站角度认为的从站超时（REPLCONF ACK pings)<br>确认这些值比定义的repl-ping-slave-period要大，否则每次主站和从站之间通信低速时都会被检测为超时。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># repl-timeout 60</span></span><br></pre></td></tr></table></figure>

<p>同步之后是否禁用从站上的TCP_NODELAY。<br>如果你选择yes，redis会使用较少量的TCP包和带宽向从站发送数据。但这会导致在从站增加一点数据的延时。<br>Linux内核默认配置情况下最多40毫秒的延时。<br>如果选择no，从站的数据延时不会那么多，但备份需要的带宽相对较多。<br>默认情况下我们将潜在因素优化，但在高负载情况下或者在主从站都跳的情况下，把它切换为yes是个好主意。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">repl-disable-tcp-nodelay</span> <span class="string">no</span></span><br></pre></td></tr></table></figure>

<p>设置备份的工作储备大小。<br>工作储备是一个缓冲区，当从站断开一段时间的情况时，它替从站接收存储数据，因此当从站重连时，通常不需要完全备份，只需要一个部分同步就可以，即把从站断开时错过的一部分数据接收。 工作储备越大，从站可以断开并稍后执行部分同步的断开时间就越长。只要有一个从站连接，就会立刻分配一个工作储备。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># repl-backlog-size 1mb</span></span><br></pre></td></tr></table></figure>

<p>主站有一段时间没有与从站连接，对应的工作储备就会自动释放。这个选项用于配置释放前等待的秒数，秒数从断开的那一刻开始计算，值为0表示不释放。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># repl-backlog-ttl 3600</span></span><br></pre></td></tr></table></figure>

<p>从站优先级是可以从redis的INFO命令输出中查到的一个整数。当主站不能正常工作时redis sentinel使用它来选择一个从站并将它提升为主站。<br>低优先级的从站被认为更适合于提升，因此如果有三个从站优先级分别是10，100，25，sentinel会选择优先级为10的从站，因为它的优先级最低。<br>然而优先级值为0的从站不能执行主站的角色，因此优先级为0的从站永远不会被redis sentinel提升。默认优先级是100。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">slave-priority</span> <span class="string">100</span></span><br></pre></td></tr></table></figure>

<p>主站可以停止接受写请求，当与它连接的从站少于N个，滞后少于M秒，N个从站必须是在线状态。<br>延迟的秒数必须&lt;=所定义的值，延迟秒数是从最后一次收到的来自从站的ping开始计算。ping通常是每秒一次。<br>这一选项并不保证N个备份都会接受写请求，但是会限制在指定秒数内由于从站数量不够导致的写操作丢失的情况。<br>默认配置是想要至少3个从站且延迟少于10秒。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># min-slaves-to-write 3</span></span><br><span class="line"><span class="comment"># min-slaves-max-lag 10</span></span><br></pre></td></tr></table></figure>

<p>Redis master能够以不同的方式列出所连接slave的地址和端口。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># slave-announce-ip 5.5.5.5</span></span><br><span class="line"><span class="comment"># slave-announce-port 1234</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="SECURITY"><a href="#SECURITY" class="headerlink" title="SECURITY"></a>SECURITY</h4><p>设置密码。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># requirepass "password"</span></span><br></pre></td></tr></table></figure>

<p>命令重命名。可将某些认为是重要的命令重命名，若设置为空字符串就等于取消了这个命令。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># rename-command CONFIG ""</span></span><br><span class="line"><span class="comment"># rename-command FLUSHALL ""  </span></span><br><span class="line"><span class="comment"># rename-command KEYS     ""</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="CLIENTS"><a href="#CLIENTS" class="headerlink" title="CLIENTS"></a>CLIENTS</h4><p>设置客户端最大并发连接数，默认无限制。<br>Redis可以同时打开的客户端连接数为Redis进程可以打开的最大文件描述符数-32（redis server自身会使用一些），如果设置 maxclients为0 表示不作限制。当客户端连接数到达限制时，Redis会关闭新的连接并向客户端返回max number of clients reached错误信息。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># maxclients 10000</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="MEMORY-MANAGEMENT"><a href="#MEMORY-MANAGEMENT" class="headerlink" title="MEMORY MANAGEMENT"></a>MEMORY MANAGEMENT</h4><p>指定Redis最大内存限制。<br>Redis在启动时会把数据加载到内存中，达到最大内存后，Redis会先尝试清除已到期或即将到期的Key当此方法处理 后，仍然到达最大内存设置，将无法再进行写入操作，但仍然可以进行读取操作。Redis新的vm机制，会把Key存放内存，Value会存放在swap区，格式：maxmemory 。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># maxmemory &lt;bytes&gt;</span></span><br></pre></td></tr></table></figure>

<p>当内存使用达到最大值时，redis使用的清除策略。<br>①volatile-lru 利用LRU算法移除设置过过期时间的key (LRU:最近使用 Least Recently Used )<br>②allkeys-lru 利用LRU算法移除任何key<br>③volatile-random 移除设置过过期时间的随机key<br>④allkeys-random 移除随机ke<br>⑤volatile-ttl 移除即将过期的key(minor TTL)<br>⑥noeviction noeviction 不移除任何key，只是返回一个写错误 ，默认选项。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">maxmemory-policy</span> <span class="string">volatile-lru</span></span><br></pre></td></tr></table></figure>

<p>LRU 和 minimal TTL 算法都不是精准的算法，但是相对精确的算法(为了节省内存)每次进行淘汰的时候会随机抽取5个元素，从里面淘汰最不常用的（缺省配置）。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">maxmemory-samples</span> <span class="string">5</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="APPEND-ONLY-MODE"><a href="#APPEND-ONLY-MODE" class="headerlink" title="APPEND ONLY MODE"></a>APPEND ONLY MODE</h4><p>是否使用使用AOF（Append Only File）的方式进行持久化。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">appendonly</span> <span class="string">no</span></span><br></pre></td></tr></table></figure>

<p>AOF持久化保存文件名。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">appendfilename</span> <span class="string">"appendonly.aof"</span></span><br></pre></td></tr></table></figure>

<p>AOF持久化策略的配置。<br>no表示不执行fsync，由操作系统保证数据同步到磁盘，速度最快。<br>always表示每次写入都执行fsync，以保证数据同步到磁盘。<br>everysec表示每秒执行一次fsync，可能会导致丢失这1s数据。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#appendfsync always</span></span><br><span class="line"><span class="meta">appendfsync</span> <span class="string">everysec</span></span><br><span class="line"><span class="comment">#appendfsync no</span></span><br></pre></td></tr></table></figure>

<p>在aof重写或者写入rdb文件的时候，会执行大量IO，此时对于everysec和always的aof模式来说，<br>执行fsync会造成阻塞过长时间，no-appendfsync-on-rewrite字段设置为默认设置为no。<br>如果对延迟要求很高的应用，这个字段可以设置为yes，否则还是设置为no，这样对持久化特性来说这是更安全的选择。<br>设置为yes表示rewrite期间对新写操作不fsync,暂时存在内存中,等rewrite完成后再写入，默认为no，建议yes。<br>Linux的默认fsync策略是30秒。可能丢失30秒数据。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">no-appendfsync-on-rewrite</span> <span class="string">no</span></span><br></pre></td></tr></table></figure>

<p>aof自动重写配置，当目前aof文件大小超过上一次重写的aof文件大小的百分之多少进行重写，即当aof文件增长到一定大小的时候，Redis能够调用bgrewriteaof对日志文件进行重写。<br>当前AOF文件大小是上次日志重写得到AOF文件大小的二倍（设置为100）时，自动启动新的日志重写过程。<br>设置允许重写的最小aof文件大小，避免了达到约定百分比但尺寸仍然很小的情况还要重写。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">auto-aof-rewrite-percentage</span> <span class="string">100</span></span><br><span class="line"><span class="meta">auto-aof-rewrite-min-size</span> <span class="string">512mb</span></span><br></pre></td></tr></table></figure>

<p>启动redis加载AOF文件时，是否自动修复AOF文件。<br>aof文件可能在尾部是不完整的，当redis启动的时候，aof文件的数据被载入内存。<br>重启可能发生在redis所在的主机操作系统宕机后，尤其在ext4文件系统没有加上data=ordered选项，出现这种现象，redis宕机或者异常终止不会造成尾部不完整现象，可以选择让redis退出，或者导入尽可能多的数据。<br>如果选择的是yes，当截断的aof文件被导入的时候，会自动发布一个log给客户端然后load。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">aof-load-truncated</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<p>是否开启RDB-AOF混合持久化格式。<br>Redis 4.0 新增的一个可选的功能，在开启了这个功能之后，AOF重写产生的文件将同时包含RDB 格式的内容和AOF格式的内容，其中RDB格式的内容用于记录已有的数据,而AOF格式的内存则用于记录最近发生了变化的数据，这样 Redis就可以同时兼有 RDB 持久化和AOF持久化的优点—— 既能够快速地生成重写文件，也能够在出现问题时，快速地载入数据。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">aof-use-rdb-preamble</span> <span class="string">no</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="LUA-SCRIPTING"><a href="#LUA-SCRIPTING" class="headerlink" title="LUA SCRIPTING"></a>LUA SCRIPTING</h4><p>Lua脚本执行如果达到最大时间限制（毫秒），redis会记个log，然后返回error。当一个脚本超过了最大时限。<br>只有SCRIPT KILL和SHUTDOWN NOSAVE可以用。第一个可以杀没有调write命令的东西。<br>要是已经调用了write，只能用第二个命令杀。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">lua-time-limit</span> <span class="string">5000</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="REDIS-CLUSTER"><a href="#REDIS-CLUSTER" class="headerlink" title="REDIS CLUSTER"></a>REDIS CLUSTER</h4><p>集群开关，默认是不开启集群模式。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cluster-enabled yes</span></span><br></pre></td></tr></table></figure>

<p>集群配置文件名称。每个节点都有一个集群相关的配置文件，持久化保存集群的信息。<br>这个文件并不需要手动配置，这个配置文件有Redis生成并更新，每个Redis集群节点需要一个单独的配置文件<br>请确保与实例运行的系统中配置文件名称不冲突。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cluster-config-file nodes-6379.conf</span></span><br></pre></td></tr></table></figure>

<p>节点互连超时的阀值，集群节点超时毫秒数。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cluster-node-timeout 15000</span></span><br></pre></td></tr></table></figure>

<p>在进行故障转移的时候，全部slave都会请求申请为master，但是有些slave可能与master断开连接一段时间了，导致数据过于陈旧，这样的slave不应该被提升为master。该参数就是用来判断slave节点与master断线的时间是否过长。<br>判断方法是：<br>比较slave断开连接的时间和(node-timeout * slave-validity-factor) + repl-ping-slave-period<br>如果节点超时时间为三十秒, 并且slave-validity-factor为10,假设默认的repl-ping-slave-period是10秒，即如果超过310秒slave将不会尝试进行故障转移。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cluster-slave-validity-factor 10</span></span><br></pre></td></tr></table></figure>

<p>master的slave数量大于该值，slave才能迁移到其他孤立master上，如这个参数若被设为2，那么只有当一个主节点拥有2 个可工作的从节点时，它的一个从节点会尝试迁移。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cluster-migration-barrier 1</span></span><br></pre></td></tr></table></figure>

<p>默认情况下，集群全部的slot有节点负责，集群状态才为ok，才能提供服务。<br>设置为no，可以在slot没有全部分配的时候提供服务。<br>不建议打开该配置，这样会造成分区的时候，小分区的master一直在接受写请求，而造成很长时间数据不一致。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">cluster-require-full-coverage</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="SLOW-LOG"><a href="#SLOW-LOG" class="headerlink" title="SLOW LOG"></a>SLOW LOG</h4><p>slow log是用来记录redis运行中执行比较慢的命令耗时。<br>当命令的执行超过了指定时间，就记录在slow log中，slog log保存在内存中，所以没有IO操作。<br>执行时间比slowlog-log-slower-than大的请求记录到slowlog里面，单位是微秒，所以1000000就是1秒。<br>注意，负数时间会禁用慢查询日志，而0则会强制记录所有命令。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">slowlog-log-slower-than</span> <span class="string">10000</span></span><br></pre></td></tr></table></figure>

<p>慢查询日志长度。当一个新的命令被写进日志的时候，最老的那个记录会被删掉，这个长度没有限制。<br>只要有足够的内存就行，你可以通过 SLOWLOG RESET 来释放内存。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">slowlog-max-len</span> <span class="string">128</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="LATENCY-MONITOR"><a href="#LATENCY-MONITOR" class="headerlink" title="LATENCY MONITOR"></a>LATENCY MONITOR</h4><p>延迟监控功能是用来监控redis中执行比较缓慢的一些操作，用LATENCY打印redis实例在跑命令时的耗时图表。<br>只记录大于等于下边设置的值的操作，0的话，就是关闭监视。<br>默认延迟监控功能是关闭的，如果你需要打开，也可以通过CONFIG SET命令动态设置。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">latency-monitor-threshold</span> <span class="string">0</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="EVENT-NOTIFICATION"><a href="#EVENT-NOTIFICATION" class="headerlink" title="EVENT NOTIFICATION"></a>EVENT NOTIFICATION</h4><p>键空间通知使得客户端可以通过订阅频道或模式，来接收那些以某种方式改动了 Redis 数据集的事件。因为开启键空间通知功能需要消耗一些 CPU ，所以在默认配置下，该功能处于关闭状态。</p>
<table>
<thead>
<tr>
<th>字符</th>
<th align="center">发送的通知</th>
</tr>
</thead>
<tbody><tr>
<td>K</td>
<td align="center">键空间通知，所有通知以<strong>keyspace@</strong>:expired为前缀</td>
</tr>
<tr>
<td>g</td>
<td align="center">del、exprire、rename等类型无关的通用命令的通知</td>
</tr>
<tr>
<td>$</td>
<td align="center">字符串命令的通知</td>
</tr>
<tr>
<td>l</td>
<td align="center">列表命令的通知</td>
</tr>
<tr>
<td>s</td>
<td align="center">集合命令的通知</td>
</tr>
<tr>
<td>h</td>
<td align="center">哈希命令的通知</td>
</tr>
<tr>
<td>z</td>
<td align="center">有序集合命令的通知</td>
</tr>
<tr>
<td>x</td>
<td align="center">过期事件，每当有过期被删除时发送</td>
</tr>
<tr>
<td>e</td>
<td align="center">驱逐(evict)事件，每当有键因为maxmemory政策而被删除时发送</td>
</tr>
<tr>
<td>A</td>
<td align="center">参数g$lshzxe的别名</td>
</tr>
</tbody></table>
<p>“notify-keyspace-events”的参数可以是以下字符的任意组合。<br>输入的参数中至少要有一个 K 或者E，否则的话，不管其余的参数是什么，都不会有任何 通知被分发。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">notify-keyspace-events</span> <span class="string">Ex</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="ADVANCED-CONFIG"><a href="#ADVANCED-CONFIG" class="headerlink" title="ADVANCED CONFIG"></a>ADVANCED CONFIG</h4><p>hash类型的数据结构在编码上可以使用ziplist和hashtable。<br>ziplist的特点就是文件存储(以及内存存储)所需的空间较小,在内容较小时,性能和hashtable几乎一样。<br>因此redis对hash类型默认采取ziplist。如果hash中条目的条目个数或者value长度达到阀值,将会被重构为hashtable。<br>这个参数指的是ziplist中允许存储的最大条目个数，，默认为512，建议为128。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hash-max-ziplist-entries</span> <span class="string">128</span></span><br></pre></td></tr></table></figure>

<p>ziplist中允许条目value值最大字节数，默认为64，建议为1024。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hash-max-ziplist-value</span> <span class="string">1024</span></span><br></pre></td></tr></table></figure>

<p>当取正值的时候，表示按照数据项个数来限定每个quicklist节点上的ziplist长度。比如，当这个参数配置成5的时候，表示每个quicklist节点的ziplist最多包含5个数据项。<br>当取负值的时候，表示按照占用字节数来限定每个quicklist节点上的ziplist长度。这时，它只能取-1到-5这五个值，每个值含义如下：<br>-5: 每个quicklist节点上的ziplist大小不能超过64 Kb。（注：1kb =&gt; 1024 bytes）<br>-4: 每个quicklist节点上的ziplist大小不能超过32 Kb。<br>-3: 每个quicklist节点上的ziplist大小不能超过16 Kb。<br>-2: 每个quicklist节点上的ziplist大小不能超过8 Kb。（-2是Redis给出的默认值）<br>-1: 每个quicklist节点上的ziplist大小不能超过4 Kb。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">list-max-ziplist-size</span> <span class="string">-2</span></span><br></pre></td></tr></table></figure>

<p>这个参数表示一个quicklist两端不被压缩的节点个数。<br>注：这里的节点个数是指quicklist双向链表的节点个数，而不是指ziplist里面的数据项个数。<br>实际上，一个quicklist节点上的ziplist，如果被压缩，就是整体被压缩的。<br>参数list-compress-depth的取值含义如下：<br>0: 是个特殊值，表示都不压缩。这是Redis的默认值。<br>1: 表示quicklist两端各有1个节点不压缩，中间的节点压缩。<br>2: 表示quicklist两端各有2个节点不压缩，中间的节点压缩。<br>3: 表示quicklist两端各有3个节点不压缩，中间的节点压缩。<br>依此类推…<br>由于0是个特殊值，很容易看出quicklist的头节点和尾节点总是不被压缩的，以便于在表的两端进行快速存取。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">list-compress-depth</span> <span class="string">0</span></span><br></pre></td></tr></table></figure>

<p>数据量小于等于set-max-intset-entries用intset，大于set-max-intset-entries用set。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">set-max-intset-entries</span> <span class="string">512</span></span><br></pre></td></tr></table></figure>

<p>数据量小于等于zset-max-ziplist-entries用ziplist，大于zset-max-ziplist-entries用zset。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">zset-max-ziplist-entries</span> <span class="string">128</span></span><br><span class="line"><span class="meta">zset-max-ziplist-value</span> <span class="string">64</span></span><br></pre></td></tr></table></figure>

<p>value大小小于等于hll-sparse-max-bytes使用稀疏数据结构（sparse）大于hll-sparse-max-bytes使用稠密的数据结构（dense），一个比16000大的value是几乎没用的，建议的value大概为3000。如果对CPU要求不高，对空间要求较高的，建议设置到10000左右。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hll-sparse-max-bytes</span> <span class="string">3000</span></span><br></pre></td></tr></table></figure>

<p>Redis将在每100毫秒时使用1毫秒的CPU时间来对redis的hash表进行重新hash，可以降低内存的使用。<br>当你的使用场景中，有非常严格的实时性需要，不能够接受Redis时不时的对请求有2毫秒的延迟的话，把这项配置为no。<br>如果没有这么严格的实时性要求，可以设置为yes，以便能够尽可能快的释放内存。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">activerehashing</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>

<p>对客户端输出缓冲进行限制可以强迫那些不从服务器读取数据的客户端断开连接，用来强制关闭传输缓慢的客户端。对于normal client，第一个0表示取消hard limit，第二个0和第三个0表示取消soft limit，normal，client默认取消限制，因为如果没有寻问，他们是不会接收数据的。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">client-output-buffer-limit</span> <span class="string">normal 0 0 0</span></span><br></pre></td></tr></table></figure>

<p>对于slave client和MONITER client，如果client-output-buffer一旦超过256mb，又或者超过64mb持续60秒，那么服务器就会立即断开客户端连接。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">client-output-buffer-limit</span> <span class="string">slave 256mb 64mb 60</span></span><br></pre></td></tr></table></figure>

<p>对于pubsub client，如果client-output-buffer一旦超过32mb，又或者超过8mb持续60秒，那么服务器就会立即断开客户端连接。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">client-output-buffer-limit</span> <span class="string">pubsub 32mb 8mb 60</span></span><br></pre></td></tr></table></figure>

<p>redis执行任务的频率为1s除以hz。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hz</span> <span class="string">10</span></span><br></pre></td></tr></table></figure>

<p>在AOF重写的时候，如果打开了aof-rewrite-incremental-fsync开关，系统会每32MB执行一次fsync。<br>这对于把文件写入磁盘是有帮助的，可以避免过大的延迟峰值。</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">aof-rewrite-incremental-fsync</span> <span class="string">yes</span></span><br></pre></td></tr></table></figure>


      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>本文链接：</strong>
      <a href="http://1445103710.github.io/2019/10/18/第八篇、Redis配置文件/" title="Redis配置文件" target="_blank" rel="external">http://1445103710.github.io/2019/10/18/第八篇、Redis配置文件/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>版权声明： </strong> 本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/1445103710" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/1445103710" target="_blank"><span class="text-dark">yaoyao</span><small class="ml-1x">天行健，君子自强不息</small></a></h3>
        <div>懒人一个。</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
      <div id="vcomments"></div>
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    
    <li class="next">
      <a href="/2019/10/17/第七篇、spring、springMvc、springBoot和springCloud的联系与区别/" title="第七篇、spring、springMvc、springBoot和springCloud的联系与区别"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>感谢您的支持，我会继续努力的!</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫" />
              </div>
              <p class="text-muted mv">扫码打赏，你说多少就多少</p>
              <p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/1445103710" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="http://weibo.com/cofess" target="_blank" title="Weibo" data-toggle=tooltip data-placement=top><i class="icon icon-weibo"></i></a></li>
        
        <li><a href="https://twitter.com/iwebued" target="_blank" title="Twitter" data-toggle=tooltip data-placement=top><i class="icon icon-twitter"></i></a></li>
        
        <li><a href="https://www.behance.net/cofess" target="_blank" title="Behance" data-toggle=tooltip data-placement=top><i class="icon icon-behance"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>
<script src="/js/plugin.min.js"></script>
<script src="/js/application.js"></script>


    <script>
(function ($) {
    $('.search-form').on('submit', function (e) {
        var keyword = $('.search-form-input[name="wd"]').val();
        window.location = 'https://www.baidu.com/s?wd=site:1445103710.github.io ' + keyword;
        return false;
    });
})(jQuery);
</script>




   




   
    
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/valine"></script>
  <script type="text/javascript">
  var GUEST = ['nick', 'mail', 'link'];
  var meta = 'nick,mail,link';
  meta = meta.split(',').filter(function(item) {
    return GUEST.indexOf(item) > -1;
  });
  new Valine({
    el: '#vcomments',
    verify: false,
    notify: false,
    appId: '',
    appKey: '',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: meta,
    pageSize: '10' || 10,
    visitor: false
  });
  </script>

     







</body>
</html>